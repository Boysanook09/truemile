<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Backend</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
        <div class="admin-bg-glow"></div>
        <header class="admin-header modern-card">
            <h1 class="gradient-title"><span class="icon-admin">üõ†Ô∏è</span> Admin Backend</h1>
            <nav class="admin-nav">
                <button class="admin-nav-btn" onclick="showAdminSection('adminProductSection')">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button>
                <button class="admin-nav-btn" onclick="showAdminSection('adminRepairSection')">‡∏á‡∏≤‡∏ô‡∏ã‡πà‡∏≠‡∏°</button>
                <button class="admin-nav-btn" onclick="showAdminSection('adminUserSection')">‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</button>
                <button class="admin-nav-btn" onclick="showAdminSection('adminSendRepairSection')">‡πÅ‡∏à‡πâ‡∏á‡∏á‡∏≤‡∏ô‡∏ã‡πà‡∏≠‡∏°</button>
                <button class="admin-nav-btn" onclick="showAdminSection('userSystemSection')">‡∏£‡∏∞‡∏ö‡∏ö User</button>
            </nav>
        </header>
        <main class="admin-main">
            <section id="adminProductSection" class="admin-section modern-card">
                <h2 class="gradient-title"><span class="icon-product">üì¶</span> ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (Admin)</h2>
                <form id="adminAddProductForm" class="modern-form">
                    <div class="form-row">
                        <label>‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
                            <input type="text" id="adminProductName" required placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤">
                        </label>
                        <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô
                            <input type="number" id="adminProductQty" required min="1" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô">
                        </label>
                        <label>‡∏£‡∏≤‡∏Ñ‡∏≤
                            <input type="number" id="adminProductPrice" min="0" step="0.01" placeholder="‡∏ö‡∏≤‡∏ó">
                        </label>
                    </div>
                    <div class="form-row">
                        <label>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
                            <input type="text" id="adminProductDetail" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤">
                        </label>
                        <label>‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î)
                            <input type="file" id="adminProductImgFile" accept="image/*">
                        </label>
                        <label>‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (URL)
                            <input type="text" id="adminProductImg" placeholder="URL ‡∏£‡∏π‡∏õ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤">
                        </label>
                    </div>
                    <button type="submit" class="modern-btn">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button>
                </form>
                <div id="adminAddProductMsg" class="msg-anim"></div>
                <h3 class="gradient-title">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h3>
                <table id="adminProductTable" class="modern-table">
                    <thead><tr><th>‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th><th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</th><th>‡∏£‡∏≤‡∏Ñ‡∏≤</th><th>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</th><th>‡∏£‡∏π‡∏õ</th><th>‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th></tr></thead>
                    <tbody id="adminProductList"></tbody>
                </table>
                <div id="editProductForm" class="modern-form">
                    <h3>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h3>
                    <label>‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤: <input type="text" id="editProductName" disabled></label>
                    <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: <input type="number" id="editProductQty" min="0"></label>
                    <label>‡∏£‡∏≤‡∏Ñ‡∏≤: <input type="number" id="editProductPrice" min="0" step="0.01"></label>
                    <label>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î: <input type="text" id="editProductDetail"></label>
                    <label>‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (URL): <input type="text" id="editProductImg"></label>
                    <button onclick="saveProductEdit()" class="modern-btn">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                    <button onclick="cancelProductEdit()" class="modern-btn">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                </div>
                <div id="productNotifyMsg" class="msg-anim"></div>
            </section>
            <section id="adminRepairSection" class="admin-section modern-card">
                <h2 class="gradient-title"><span class="icon-repair">üõ†Ô∏è</span> ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡∏ã‡πà‡∏≠‡∏° (Admin/‡∏ä‡πà‡∏≤‡∏á)</h2>
                <table id="adminRepairTable" class="modern-table">
                    <thead><tr><th>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÅ‡∏à‡πâ‡∏á</th><th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th><th>‡πÄ‡∏ß‡∏•‡∏≤</th><th>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</th><th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th><th>‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th></tr></thead>
                    <tbody id="adminRepairList"></tbody>
                </table>
                <div id="adminRepairMsg" class="msg-anim"></div>
            </section>
            <section id="adminUserSection" class="admin-section modern-card">
                <h2 class="gradient-title"><span class="icon-user">üë§</span> ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</h2>
                <table id="userTable" class="modern-table">
                    <thead>
                        <tr><th>Username</th><th>Role</th><th>Action</th></tr>
                    </thead>
                    <tbody>
                        <tr><td>admin</td><td>Admin</td><td><button disabled>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button></td></tr>
                        <tr><td>user</td><td>User</td><td><button onclick="editUser('user')">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button></td></tr>
                    </tbody>
                </table>
                <div id="editUserForm1" class="modern-form edit-user-form1">
                    <h3>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</h3>
                    <label>Username: <input type="text" id="editUsername1" disabled></label><br>
                    <label>Password: <input type="password" id="editPassword1"></label><br>
                    <button onclick="saveUser1()" class="modern-btn">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                    <button onclick="cancelEdit1()" class="modern-btn">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                </div>
                <div id="editConfirmModal" class="modal">
                    <div class="modal-content">
                        <p>‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ô‡∏µ‡πâ?</p>
                        <button id="confirmEditBtn">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>
                        <button id="cancelEditBtn">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    </div>
                </div>
            </section>
            <section id="adminSendRepairSection" class="admin-section modern-card">
                <h2 class="gradient-title"><span class="icon-send">üì®</span> ‡πÅ‡∏à‡πâ‡∏á‡∏á‡∏≤‡∏ô‡∏ã‡πà‡∏≠‡∏°‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡πÅ‡∏ú‡∏ô‡∏á‡∏ä‡πà‡∏≤‡∏á</h2>
                <form id="adminSendRepairForm" class="modern-form">
                    <div class="form-row">
                        <label>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÅ‡∏à‡πâ‡∏á
                            <input type="text" id="adminRepairName" required placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÅ‡∏à‡πâ‡∏á">
                        </label>
                        <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà
                            <input type="date" id="adminRepairDate" required>
                        </label>
                        <label>‡πÄ‡∏ß‡∏•‡∏≤
                            <input type="time" id="adminRepairTime" required>
                        </label>
                    </div>
                    <div class="form-row">
                        <label>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏õ‡∏±‡∏ç‡∏´‡∏≤
                            <input type="text" id="adminRepairDetail" required placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î">
                        </label>
                        <label>‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà
                            <input type="text" id="adminRepairLocation" placeholder="‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà">
                        </label>
                        <label>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠
                            <input type="tel" id="adminRepairPhone" placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠">
                        </label>
                    </div>
                    <button type="submit" class="modern-btn">‡πÅ‡∏à‡πâ‡∏á‡∏á‡∏≤‡∏ô‡∏ã‡πà‡∏≠‡∏°</button>
                </form>
                <div id="adminSendRepairMsg" class="msg-anim"></div>
            </section>
            <section id="userSystemSection" class="admin-section modern-card">
                <h2 class="gradient-title"><span class="icon-user">üë§</span> ‡∏£‡∏∞‡∏ö‡∏ö User</h2>
                <form id="addUserForm" class="modern-form">
                    <label>Username: <input type="text" id="newUsername" required placeholder="Username"></label>
                    <label>Password: <input type="password" id="newPassword" required placeholder="Password"></label>
                    <button type="submit" class="modern-btn">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏´‡∏°‡πà</button>
                </form>
                <div id="addUserMessage" class="msg-anim"></div>
                <input type="text" id="searchUser" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ..." class="modern-form search-input">
                <h3 class="gradient-title">‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</h3>
                <table id="userListTable" class="modern-table">
                    <thead>
                        <tr><th>Username</th><th>Role</th><th>Action</th></tr>
                    </thead>
                    <tbody id="userList"></tbody>
                </table>
                <div id="editUserForm" class="modern-form">
                    <h3>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</h3>
                    <label>Username: <input type="text" id="editUsername" disabled></label>
                    <label>Password: <input type="password" id="editPassword"></label>
                    <label>Role: 
                        <select id="editRole">
                            <option value="User">User</option>
                            <option value="Admin">Admin</option>
                        </select>
                    </label>
                    <button onclick="saveUser()" class="modern-btn">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                    <button onclick="cancelEdit()" class="modern-btn">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                </div>
            </section>
            <section id="adminSalesCustomerSection" class="admin-section modern-card">
                <h2 class="gradient-title"><span class="icon-sales">üõí</span> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏à‡∏≤‡∏Å‡πÄ‡∏ã‡∏•‡∏™‡πå</h2>
                <table id="adminSalesCustomerTable" class="modern-table">
                    <thead><tr><th>‡∏ä‡∏∑‡πà‡∏≠</th><th>‡∏ß‡∏±‡∏ô-‡πÄ‡∏ß‡∏•‡∏≤</th><th>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà</th><th>‡πÄ‡∏ö‡∏≠‡∏£‡πå</th><th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th><th>‡∏£‡∏π‡∏õ‡∏ñ‡πà‡∏≤‡∏¢</th><th>‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th></tr></thead>
                    <tbody id="adminSalesCustomerList"></tbody>
                </table>
                <div id="editSalesCustomerForm" class="modern-form">
                    <h3>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</h3>
                    <label>‡∏ä‡∏∑‡πà‡∏≠: <input type="text" id="editCustomerName"></label>
                    <label>‡∏ß‡∏±‡∏ô-‡πÄ‡∏ß‡∏•‡∏≤: <input type="datetime-local" id="editCustomerDatetime"></label>
                    <label>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà: <input type="text" id="editCustomerAddress"></label>
                    <label>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£: <input type="tel" id="editCustomerPhone"></label>
                    <label>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: 
                        <select id="editCustomerStatus">
                            <option value="‡πÉ‡∏´‡∏°‡πà">‡πÉ‡∏´‡∏°‡πà</option>
                            <option value="‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°">‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°</option>
                            <option value="‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢">‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢</option>
                        </select>
                    </label>
                    <label>‡∏£‡∏π‡∏õ‡∏ñ‡πà‡∏≤‡∏¢: <input type="file" id="editCustomerPhoto" accept="image/*"></label>
                    <button onclick="saveEditSalesCustomer()" class="modern-btn">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                    <button onclick="cancelEditSalesCustomer()" class="modern-btn">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                </div>
            </section>
        </main>
    <script>
    function showAdminSection(id) {
        document.querySelectorAll('.admin-section').forEach(sec => sec.style.display = 'none');
        const el = document.getElementById(id);
        if (el) el.style.display = 'block';
    }
    document.getElementById('userManagementMenu').onclick = function() {
        document.getElementById('userManagementSection').style.display = 'block';
        document.getElementById('userSystemSection').style.display = 'none';
    };
    document.getElementById('userSystemMenu').onclick = function() {
        document.getElementById('userSystemSection').style.display = 'block';
        document.getElementById('userManagementSection').style.display = 'none';
    };
    let _pendingEdit = null;
    function renderUserList(filter = '') {
        const users = getUsers();
        const tbody = document.getElementById('userList');
        tbody.innerHTML = '';
        users.filter(u => u.username.includes(filter)).forEach((u, idx) => {
            tbody.innerHTML += `<tr><td>${u.username}</td><td>${u.role}</td><td>` +
                (u.username !== 'admin' ?
                `<button onclick="editUser('${u.username}')">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button> <button onclick="deleteUser('${u.username}')">‡∏•‡∏ö</button>` :
                `<button disabled>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button> <button disabled>‡∏•‡∏ö</button>`) +
                `</td></tr>`;
        });
    }
    document.getElementById('searchUser').oninput = function() {
        renderUserList(this.value.trim());
    };
    function editUser(username) {
        const users = getUsers();
        const user = users.find(u => u.username === username);
        document.getElementById('editUserForm').style.display = 'block';
        document.getElementById('editUsername').value = user.username;
        document.getElementById('editPassword').value = user.password;
        document.getElementById('editRole').value = user.role;
        window._editingUser = username;
    }
    function saveUserEdit() {
        event.preventDefault();
        _pendingEdit = {
            username: document.getElementById('editUsername').value,
            password: document.getElementById('editPassword').value,
            role: document.getElementById('editRole').value
        };
        document.getElementById('editConfirmModal').style.display = 'block';
    }
    document.getElementById('confirmEditBtn').onclick = function() {
        const users = getUsers();
        const idx = users.findIndex(u => u.username === _pendingEdit.username);
        if (idx !== -1) {
            users[idx].password = _pendingEdit.password;
            users[idx].role = _pendingEdit.role;
            setUsers(users);
            renderUserList();
        }
        document.getElementById('editUserForm').style.display = 'none';
        document.getElementById('editConfirmModal').style.display = 'none';
        _pendingEdit = null;
    };
    document.getElementById('cancelEditBtn').onclick = function() {
        document.getElementById('editConfirmModal').style.display = 'none';
        _pendingEdit = null;
    };
    function deleteUser(username) {
        if (!confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ô‡∏µ‡πâ‡∏à‡∏£‡∏¥‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) return;
        let users = getUsers();
        users = users.filter(u => u.username !== username);
        setUsers(users);
        renderUserList();
    }
    // User storage in localStorage
    function getUsers() {
        return JSON.parse(localStorage.getItem('users') || '[{"username":"admin","password":"1234","role":"Admin"},{"username":"user","password":"1234","role":"User"}]');
    }
    function setUsers(users) {
        localStorage.setItem('users', JSON.stringify(users));
    }
    function renderUserList() {
        const users = getUsers();
        const tbody = document.getElementById('userList');
        tbody.innerHTML = '';
        users.forEach((u, idx) => {
            tbody.innerHTML += `<tr><td>${u.username}</td><td>${u.role}</td><td>` +
                (u.username !== 'admin' ?
                `<button onclick="editUser('${u.username}')">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button> <button onclick="deleteUser('${u.username}')">‡∏•‡∏ö</button>` :
                `<button disabled>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button> <button disabled>‡∏•‡∏ö</button>`) +
                `</td></tr>`;
        });
    }
    document.getElementById('addUserForm').onsubmit = function(e) {
        e.preventDefault();
        const username = document.getElementById('newUsername').value.trim();
        const password = document.getElementById('newPassword').value;
        const users = getUsers();
        const msg = document.getElementById('addUserMessage');
        if (users.find(u => u.username === username)) {
            msg.textContent = 'Username ‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡πâ‡∏ß';
            msg.style.color = '#d32f2f';
            return;
        }
        users.push({username, password, role: 'User'});
        setUsers(users);
        msg.textContent = '‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏´‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!';
        msg.style.color = '#0078d7';
        renderUserList();
        this.reset();
    };
    // Render user list on open
    document.getElementById('userSystemMenu').onclick = function() {
        document.getElementById('userSystemSection').style.display = 'block';
        renderUserList();
    };
    function getNotifications() {
        return JSON.parse(localStorage.getItem('notifications') || '[]');
    }
    function setNotifications(n) {
        localStorage.setItem('notifications', JSON.stringify(n));
    }
    document.getElementById('notifyForm').onsubmit = function(e) {
        e.preventDefault();
        const msg = document.getElementById('notifyMsg').value.trim();
        if (!msg) return;
        const noti = getNotifications();
        noti.push({msg, date: new Date().toLocaleString()});
        setNotifications(noti);
        document.getElementById('notifyStatus').textContent = '‡∏™‡πà‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!';
        document.getElementById('notifyStatus').style.color = '#0078d7';
        this.reset();
    };
    function getProducts() {
        return JSON.parse(localStorage.getItem('products') || '[]');
    }
    function setProducts(p) {
        localStorage.setItem('products', JSON.stringify(p));
    }
    function renderAdminProductList() {
        const products = getProducts();
        const tbody = document.getElementById('adminProductList');
        tbody.innerHTML = '';
        products.forEach((p, idx) => {
            tbody.innerHTML += `<tr><td>${p.name}</td><td>${p.qty}</td><td>${p.price || '-'} </td><td>${p.detail || '-'}</td><td>${p.img ? `<img src='${p.img}'>` : '-'}</td><td><button onclick="editProduct(${idx})">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button> <button onclick="deleteProduct(${idx})">‡∏•‡∏ö</button></td></tr>`;
        });
    }
    function editProduct(idx) {
        const products = getProducts();
        const p = products[idx];
        document.getElementById('editProductForm').style.display = 'block';
        document.getElementById('editProductName').value = p.name;
        document.getElementById('editProductQty').value = p.qty;
        document.getElementById('editProductPrice').value = p.price || '';
        document.getElementById('editProductDetail').value = p.detail || '';
        document.getElementById('editProductImg').value = p.img || '';
        window._editingProductIdx = idx;
    }
    function saveProductEdit() {
        event.preventDefault();
        const products = getProducts();
        const idx = window._editingProductIdx;
        if (idx === undefined) return;
        products[idx].qty = parseInt(document.getElementById('editProductQty').value);
        products[idx].price = document.getElementById('editProductPrice').value;
        products[idx].detail = document.getElementById('editProductDetail').value;
        products[idx].img = document.getElementById('editProductImg').value;
        setProducts(products);
        renderAdminProductList();
        document.getElementById('editProductForm').style.display = 'none';
        showProductNotify('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!');
    }
    function cancelProductEdit() {
        event.preventDefault();
        document.getElementById('editProductForm').style.display = 'none';
    }
    function deleteProduct(idx) {
        if (!confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡∏à‡∏£‡∏¥‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) return;
        let products = getProducts();
        products.splice(idx, 1);
        setProducts(products);
        renderAdminProductList();
        showProductNotify('‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!');
    }
    function showProductNotify(msg) {
        const el = document.getElementById('productNotifyMsg');
        el.textContent = msg;
        el.style.color = '#0078d7';
        el.style.marginTop = '10px';
        // Save product notification for user
        let productNoti = JSON.parse(localStorage.getItem('productNotifications') || '[]');
        productNoti.push({msg, date: new Date().toLocaleString()});
        localStorage.setItem('productNotifications', JSON.stringify(productNoti));
        setTimeout(() => { el.textContent = ''; }, 2000);
    }
    document.getElementById('adminAddProductForm').onsubmit = async function(e) {
        e.preventDefault();
        const name = document.getElementById('adminProductName').value.trim();
        const qty = parseInt(document.getElementById('adminProductQty').value);
        const price = document.getElementById('adminProductPrice').value;
        const detail = document.getElementById('adminProductDetail').value;
        const imgUrl = document.getElementById('adminProductImg').value;
        const imgFile = document.getElementById('adminProductImgFile').files[0];
        let img = imgUrl;
        if (imgFile) {
            img = await new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = e => resolve(e.target.result);
                reader.onerror = reject;
                reader.readAsDataURL(imgFile);
            });
        }
        const msg = document.getElementById('adminAddProductMsg');
        if (!name || qty < 1) return;
        let products = getProducts();
        const exist = products.find(p => p.name === name);
        if (exist) {
            exist.qty += qty;
            if (price) exist.price = price;
            if (detail) exist.detail = detail;
            if (img) exist.img = img;
            msg.textContent = '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏î‡∏¥‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!';
            msg.style.color = '#0078d7';
        } else {
            products.push({name, qty, price, detail, img});
            msg.textContent = '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!';
            msg.style.color = '#0078d7';
        }
        setProducts(products);
        renderAdminProductList();
        this.reset();
    };
    function getRepairs() {
        return JSON.parse(localStorage.getItem('repairs') || '[]');
    }
    function setRepairs(r) {
        localStorage.setItem('repairs', JSON.stringify(r));
    }
    function renderAdminRepairList() {
        const repairs = getRepairs();
        const tbody = document.getElementById('adminRepairList');
        tbody.innerHTML = '';
        repairs.forEach((r, idx) => {
            tbody.innerHTML += `<tr><td>${r.name}</td><td>${r.date}</td><td>${r.time}</td><td>${r.detail}</td><td>${r.status}</td><td><select onchange="updateRepairStatus(${idx}, this.value)"><option value="‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£" ${r.status==='‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£'?'selected':''}>‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</option><option value="‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£" ${r.status==='‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£'?'selected':''}>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</option><option value="‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô" ${r.status==='‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô'?'selected':''}>‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô</option></select></td></tr>`;
        });
    }
    function updateRepairStatus(idx, status) {
        let repairs = getRepairs();
        repairs[idx].status = status;
        setRepairs(repairs);
        renderAdminRepairList();
        document.getElementById('adminRepairMsg').textContent = '‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏á‡∏≤‡∏ô‡∏ã‡πà‡∏≠‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!';
        setTimeout(()=>{document.getElementById('adminRepairMsg').textContent='';}, 1500);
        // ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏õ‡∏¢‡∏±‡∏á user
        let repairNoti = JSON.parse(localStorage.getItem('repairNotifications') || '[]');
        const r = repairs[idx];
        repairNoti.push({msg: `‡∏á‡∏≤‡∏ô‡∏ã‡πà‡∏≠‡∏°‡∏Ç‡∏≠‡∏á ${r.name} (${r.detail}) ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏õ‡πá‡∏ô: ${status}`, date: new Date().toLocaleString()});
        localStorage.setItem('repairNotifications', JSON.stringify(repairNoti));
    }
    // ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡∏ã‡πà‡∏≠‡∏°‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤ admin
    window.onload = function() {
        showAdminSection('adminProductSection');
        renderAdminRepairList();
    };
    document.getElementById('adminSendRepairForm').onsubmit = function(e) {
        e.preventDefault();
        const name = document.getElementById('adminRepairName').value.trim();
        const date = document.getElementById('adminRepairDate').value;
        const time = document.getElementById('adminRepairTime').value;
        const detail = document.getElementById('adminRepairDetail').value;
        const location = document.getElementById('adminRepairLocation').value;
        const phone = document.getElementById('adminRepairPhone').value;
        let repairs = JSON.parse(localStorage.getItem('repairs') || '[]');
        repairs.push({name, date, time, detail, location, phone, status: '‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£'});
        localStorage.setItem('repairs', JSON.stringify(repairs));
        document.getElementById('adminSendRepairMsg').textContent = '‡πÅ‡∏à‡πâ‡∏á‡∏á‡∏≤‡∏ô‡∏ã‡πà‡∏≠‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!';
        document.getElementById('adminSendRepairMsg').style.color = '#0078d7';
        // ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏ú‡∏ô‡∏á‡∏ä‡πà‡∏≤‡∏á
        let techNoti = JSON.parse(localStorage.getItem('technicianNotifications') || '[]');
        techNoti.push({msg: `‡∏°‡∏µ‡∏á‡∏≤‡∏ô‡∏ã‡πà‡∏≠‡∏°‡πÉ‡∏´‡∏°‡πà‡∏à‡∏≤‡∏Å‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô: ${detail} (${location})`, date: new Date().toLocaleString()});
        localStorage.setItem('technicianNotifications', JSON.stringify(techNoti));
        this.reset();
    };
    function getAdminSalesCustomers() {
        return JSON.parse(localStorage.getItem('adminSalesCustomers') || '[]');
    }
    function setAdminSalesCustomers(list) {
        localStorage.setItem('adminSalesCustomers', JSON.stringify(list));
    }
    let editingSalesCustomerIdx = null;
    function renderAdminSalesCustomerList() {
        const list = getAdminSalesCustomers();
        const tbody = document.getElementById('adminSalesCustomerList');
        tbody.innerHTML = '';
        list.forEach((c, idx) => {
            tbody.innerHTML += `<tr><td>${c.name}</td><td>${c.datetime}</td><td>${c.address}</td><td>${c.phone}</td><td>${c.status}</td><td>${c.photo ? `<img src='${c.photo}' style='width:40px;height:40px;object-fit:cover;border-radius:6px;'>` : '-'}</td><td><button onclick="editAdminSalesCustomer(${idx})">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button> <button onclick="deleteAdminSalesCustomer(${idx})">‡∏•‡∏ö</button></td></tr>`;
        });
    }
    window.editAdminSalesCustomer = function(idx) {
        const list = getAdminSalesCustomers();
        const c = list[idx];
        editingSalesCustomerIdx = idx;
        document.getElementById('editCustomerName').value = c.name;
        document.getElementById('editCustomerDatetime').value = c.datetime;
        document.getElementById('editCustomerAddress').value = c.address;
        document.getElementById('editCustomerPhone').value = c.phone;
        document.getElementById('editCustomerStatus').value = c.status;
        document.getElementById('editSalesCustomerForm').style.display = 'block';
    };
    window.saveEditSalesCustomer = async function() {
        const list = getAdminSalesCustomers();
        if(editingSalesCustomerIdx === null) return;
        const name = document.getElementById('editCustomerName').value.trim();
        const datetime = document.getElementById('editCustomerDatetime').value;
        const address = document.getElementById('editCustomerAddress').value.trim();
        const phone = document.getElementById('editCustomerPhone').value.trim();
        const status = document.getElementById('editCustomerStatus').value;
        const photoFile = document.getElementById('editCustomerPhoto').files[0];
        let photo = list[editingSalesCustomerIdx].photo;
        if (photoFile) {
            photo = await new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = e => resolve(e.target.result);
                reader.onerror = reject;
                reader.readAsDataURL(photoFile);
            });
        }
        list[editingSalesCustomerIdx] = {name, datetime, address, phone, status, photo};
        setAdminSalesCustomers(list);
        renderAdminSalesCustomerList();
        document.getElementById('editSalesCustomerForm').style.display = 'none';
        editingSalesCustomerIdx = null;
    };
    window.cancelEditSalesCustomer = function() {
        document.getElementById('editSalesCustomerForm').style.display = 'none';
        editingSalesCustomerIdx = null;
    };
    // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏à‡∏≤‡∏Å‡πÄ‡∏ã‡∏•‡∏™‡πå‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å section
    document.querySelector('.admin-nav-btn[onclick*="adminSalesCustomerSection"]').onclick = function() {
        showAdminSection('adminSalesCustomerSection');
        renderAdminSalesCustomerList();
    };
    </script>
    <!-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏´‡∏•‡∏±‡∏á‡∏ö‡πâ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà -->
</body>
</html>
